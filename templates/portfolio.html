{% extends "base.html" %}

{% set active_page = "portfolio" %}

{% block title %} Portfolio overview {% endblock %}

{% block divs %}

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-3 top-bottom">
                <h3>About</h3>
                <div class="justify">
                    Break-down of portfolio and some analytics and KPIs on portfolio level.
                </div>

                <h3>Controls</h3>
                {% block datetimepicker %} {{ super() }} {% endblock %}

                {% if asset_types | length > 0 %}
                <h3>Summary</h3>
                <table class="table" style="font-size: 100%;">
                    <thead>
                        <tr>
                            <th><label class="icon-left"><img src="static/icons/money.svg" alt="Money"></label></th>
                            <th><span title="All production by assets of this type.">Production (MWh)</span></th>
                            <th><span title="All consumption by assets of this type.">Consumption (MWh)</span></th>
                            <th><span title="The revenue achieved by assets of this type (on the day-ahead market).">Revenue (KRW)</span></th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for asset_type_name in asset_types %}
                        <tr>
                            <td>{{ asset_type_name }}</td>
                            <td>{% if asset_types[asset_type_name].is_producer %}{{ "{:,.2f}".format( generation_per_asset_type[asset_type_name]  | round(2)) }} MWh {% endif %}</td>
                            <td>{% if asset_types[asset_type_name].is_consumer %}{{ "{:,.2f}".format( consumption_per_asset_type[asset_type_name]  | round(2)) }} MWh {% endif %}</td>
                            <td>{{ "{:,.2f}".format( profit_loss_per_asset_type[asset_type_name] | round(2)) }} KRW</td>
                        </tr>
                    {% endfor %}
                    {% if asset_types | length > 1 %}
                        <tr style="font-weight: bold;">
                            <td>Total</td>
                            <td>{{ "{:,.2f}".format( sum_generation | round(2)) }} MWh</td>
                            <td>{{ "{:,.2f}".format( sum_consumption | round(2)) }} MWh</td>
                            <td>{{ "{:,.2f}".format( sum_profit_loss | round(2)) }} KRW</td>
                        </tr>
                    {% endif %}
                    </tbody>
                </table>
                {% endif %}

                <div class="todo">
                    <h3>To do</h3>
                    <div class="justify">
                        <table class="table" style="font-size: 100%;">
                            <thead>
                                <tr>
                                    <th>Feature</th>
                                    <th>Expected</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Portfolio editing: adding/removing assets</td>
                                    <td>M2</td>
                                </tr>
                                <tr>
                                    <td>Portfolio editing: assigning assets to prices</td>
                                    <td>M2</td>
                                </tr>
                                <tr>
                                    <td>...</td>
                                    <td>...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-sm-9">

                <div class="row">
                    <h3>Portfolio status</h3>
                    {{ portfolio_plot_div | safe }}
                    {{ portfolio_plot_script | safe }}
                    <a href="?show_stacked={{alt_stacking}}">Switch to showing stacked {{ alt_stacking }}</a>
                </div>

                <div class="row">
                    <h3>Asset status</h3>
                    <div class="wrapper small-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Asset</th>
                                    <th>Supplier</th>
                                    <th>Aggregator</th>
                                    <!--<th>Energy Service Company</th>-->
                                    <th>Production</th>
                                    <th>Consumption</th>
                                    <th>Profit/Loss</th>
                                    <th>Type of actions</th>
                                    <th>Available capacity</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for asset in assets: %}
                                <tr class="active">
                                    <td>
                                        <label class="icon-left">
                                            {% if asset.asset_type_name == "wind" %}
                                            <img src="/static/icons/wind.svg" alt="Wind">
                                            {% endif %}
                                            {% if asset.asset_type_name == "solar" %}
                                            <img src="/static/icons/sun.svg" alt="Solar">
                                            {% endif %}
                                            {% if asset.asset_type_name == "charging_station" %}
                                            <img src="/static/icons/battery.svg" alt="Vehicle">
                                            {% endif %}
                                            {% if asset.asset_type_name == "building" %}
                                            <img src="/static/icons/house.svg" alt="Building">
                                            {% endif %}
                                            {% if asset.asset_type_name == "battery" %}
                                            <img src="/static/icons/battery.svg" alt="Battery">
                                            {% endif %}
                                        </label>
                                        {{ asset.display_name }}
                                    </td>
                                    <td>KEPCO</td>
                                    <td>My AGR</td>
                                    <!--td>ESCo 1</td-->
                                    <td>
                                        {% if asset.asset_type.is_producer %}
                                        <a href="analytics?resource={{ asset.name | urlencode }}">
                                            {{ generation_per_asset[asset.name] | round(2) }} MWh
                                        </a>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if asset.asset_type.is_consumer %}
                                        <a href="analytics?resource={{ asset.name | urlencode }}">
                                            {{ consumption_per_asset[asset.name] | round(2) }} MWh
                                        </a>
                                        {% endif %}
                                    </td>
                                    <td><a href="analytics?resource={{ asset.name | urlencode }}">{{ profit_loss_per_asset[asset.name] | round(2) }} KRW</a></td>
                                    <td>
                                        {% if asset.asset_type_name in ("wind", "house") %}<a href="control">Curtail load</a>{% endif %}
                                        {% if asset.asset_type_name in ("charging_station", "building") %}<a href="control">Shift load</a>{% endif %}
                                    </td>
                                    <td>
                                        {% if not prosumer_mock: %}
                                            {% if "onshore" in asset.name:%}
                                            60%
                                            {% else %}
                                            100%
                                            {% endif%}
                                        {% endif %}
                                        {% if prosumer_mock: %}
                                        <select>
                                            <option>100%</option>
                                            <option>80%</option>
                                            <option selected="selected">60%</option>
                                            <option>40%</option>
                                            <option>20%</option>
                                        </select>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="row">
                    <h3>Market status</h3>
                    <table class="table" style="font-size: 100%;">
                        <thead>
                            <tr>
                                <th>Market</th>
                                <th>Product</th>
                                <th>Average price</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>KPX DAM</td>
                                <td>Hourly</td>
                                <td>1 KRW/MWh</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
        
{% endblock %}