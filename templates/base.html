{% extends "defaults.jinja" %}

{% block base %}

    <!DOCTYPE html>
    <html lang="en">
        <head>
            {% block head %}
                <title>{% block title %}{% endblock %} - {{ app_name }}</title>
            {% endblock head %}
            <meta charset="windows-1252">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <link rel="icon" href="favicon.ico" type="image/x-icon" />
            <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
            <!-- Leaflet -->
            <link href="static/css/external/leaflet.css" rel="stylesheet"/>
            <!-- Bootstrap -->
            <link href="static/css/external/bootstrap.min.css" rel="stylesheet"/>
            {% if show_datepicker %}
                <link href="static/css/external/daterangepicker.css" rel="stylesheet"/>
            {% endif %}
            <!-- Font awesome -->
            <link href="static/css/external/font-awesome.min.css" rel="stylesheet"/>
            <!-- Ion range slider -->
            <link href="static/css/external/ion.rangeSlider.css" rel="stylesheet"/>
            <link href="static/css/external/ion.rangeSlider.skinCustom.css" rel="stylesheet"/>
            <!-- Custom CSS -->
            <link href="static/css/a1-vpp.css" rel="stylesheet"/>
            {% if contains_plots %}
                {{ bokeh_css_resources|indent(4)|safe }}
                {{ bokeh_js_resources|indent(4)|safe }}
            {% endif %}
        </head>
        <body>

            {% block body %}

                {% block nav %}

                    <nav class="navbar navbar-default">
                        <div class="container-fluid">
                            <div class="navbar-header">
                                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                                    <span class="sr-only">Toggle navigation</span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                                <span class="navbar-brand"><span class="navbar-tool-name">{{ app_name_short }}</span>{{ self.title() }} for
                                    {% for id, caption, icon in user_list_mock %}
                                        {% if id == prosumer_mock %}
                                            {% set active_user = caption %}
                                        {% endif %}
                                        {{ active_user }}
                                    {% endfor %}
                                    on Jeju island

                                </span>
                            </div>
                            <div class="collapse navbar-collapse  navbar-right" id="bs-example-navbar-collapse-1">
                                {% if page != "analytics" %}
                                <ul class="nav navbar-nav">	
                                    {% for href, id, caption, icon in navigation_bar %}
                                        <li{% if id == active_page %} class="active"{% endif %}>
                                            <a href="{{ href|e }}"> <span class="fa fa-{{ icon }}" aria-hidden="true"></span> {{ caption|e }}</a>
                                        </li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                <button onclick="window.close(); return false;">
                                    Close Analysis View
                                </button>
                                {% endif %}
                            </div>
                        </div>
                    </nav>

                {% endblock nav %}

                {% if message and message != "" %}
                    <div class="info">{{ message}} </div>
                {% endif %}

                <!-- loading this earlier so templates can use it -->
                <script src="static/js/external/jquery-3.1.0.min.js"></script>
                <script src="static/js/external/jquery.floatThead.min.js"></script>

                <!-- This should always be there, even on error pages  -->
                <script type="text/javascript">
                    var timerangeStart = "{{ start_time }}";
                    var timerangeEnd = "{{ end_time }}";
                </script>

                {# Div blocks that child pages can reference #}
                {% block divs %}


                    {% block datetimepicker %}

                        <div class="form-group datetimepicker">
                            <div class="heading-group">
                                <i class="icon-time"></i>
                                <label class="control-label">Time window</label>
                            </div>
                            <div class="btn-group btn-group-justified">
                                <input type="text" name="daterange" value="01/01/2015 1:30 PM - 01/01/2015 2:00 PM" />
                            </div>
                        </div>
                        <!-- form to refresh page -->
                        <form style="display: hidden" action="" method="POST" id="datepicker_form">
                            <input type="hidden" id="datepicker_form_start_time" name="start_time" value="{{ start_time }}"/>
                            <input type="hidden" id="datepicker_form_end_time" name="end_time" value="{{ end_time }}"/>
                        </form>

                        <script src="static/js/external/moment.min.js"></script>
                    {% endblock datetimepicker %}
                    
                    {% block forecastpicker %}
                        
                        <div class="form-group">
                            <div class="heading-group">
                                <label class="icon-left" aria-hidden="true">
                                    <img src="/static/icons/binoculars.svg" alt="Forecast">
                                </label>
                                <label class="control-label">Forecast (rolling)</label>
                            </div>
<!--                        <div class="btn-group btn-group-justified" role="group" aria-label="...">
                                <a role="button" href="#" class="btn btn-default forecast-toggle active" forecast-type="rolling">Rolling</a>
                                <a role="button" href="#" class="btn btn-default forecast-toggle" forecast-type="static">Static</a>
                            </div>-->
                            <div>
                                <form action="" method="POST" id="forecast_horizon_form">
                                    <select class="form-control" id="forecast_horizon" name="forecast_horizon" onchange="this.form.submit()">
                                        {% for horizon in forecast_horizons %}
                                        <option value="{{ horizon }}" {% if horizon == active_forecast_horizon %} selected="selected"{% endif %}>per {{ horizon }}</option>
                                        {% endfor %}
                                    </select>
                                </form>
                            </div>
                        </div>

                    {% endblock forecastpicker %}
                    
                    {% block attributions %}
                        <div id="att-text" style="display: none;">
                            <ul>
                                <li>Plots made with <a href="https://bokeh.pydata.org">Bokeh</a>.</li>
                                <li>Icons made by <a href="http://freepik.com">Freepik</a>, <a href="https://www.flaticon.com/authors/tomas-knop" title="Tomas Knop">Tomas Knop</a>, <a href="https://www.flaticon.com/authors/gregor-cresnar" title="Gregor Cresnar">Gregor Cresnar</a> and <a href="https://www.flaticon.com/authors/those-icons" title="Those Icons">Those Icons</a> from <a href="http://flaticon.com">www.flaticon.com</a>.</li>
                            </ul>
                        </div>
                    {% endblock attributions %}

                {% endblock divs %}
                
                <!-- External scripts -->
                <script src="static/js/external/ion.rangeSlider.min.js"></script>
                <script src="static/js/external/bootstrap.min.js"></script>

                <!-- Custom scripts -->
                <script src="static/js/a1-vpp.js"></script>
                {% if show_datepicker %}
                    <script src="static/js/daterangepicker-init.js"></script>
                {% endif %}

                <!-- External scripts that should run after custom scripts -->
                {% if show_datepicker %}
                    <script src="static/js/external/daterangepicker.js"></script>
                {% endif %}

                {% if page != "error" %}
                    <div class="alert alert-info">
                        {% if prosumer_mock == "0": %}
                            This is the view of <b>an aggregator or supplier</b>. All assets are listed.
                        {% else: %}
                        This is the view of <b>a prosumer who owns "{{ prosumer_mock }}" assets</b>. Only the assets owned by this prosumer are listed.
                            {% if page == "portfolio": %}
                                The prosumer can put constraints for actions in place, for example available capacity.
                            {% endif %}
                        {% endif %}
                        <br/>
                        Here are possible (mocked) user perspectives:
                        {% for id, caption, icon in user_list_mock %}
                            <button onclick="window.location.href='?prosumer_mock={{ id }}'">
                                <span class="fa fa-{{ icon }}" aria-hidden="true"></span>
                                {{ caption|e }}
                            </button>
                        {% endfor %}
                    </div>
                {% endif %}

            {% endblock body %}
        </body>
    </html>
    
{% endblock base %}
